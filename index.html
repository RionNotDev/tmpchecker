<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mietubl Model Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #f7f7f7; }
        .container { background: #fff; padding: 2em; border-radius: 8px; max-width: 600px; margin: auto; box-shadow: 0 2px 8px #0001; }
        h1 { text-align: center; }
        label { display: block; margin-top: 1em; }
        input, select, button { width: 100%; padding: 0.5em; margin-top: 0.5em; }
        .results { margin-top: 2em; }
        .error { color: #b00; }
        .group { margin-bottom: 1em; padding: 1em; background: #f0f0f0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mietubl Model Search</h1>
        <form id="searchForm">
            <label for="model">Model Name:</label>
            <input type="text" id="model" name="model" required>
            <label for="panel">Panel Type:</label>
            <select id="panel" name="panel">
                <option value="HD clear glass">HD clear glass</option>
                <option value="Matte glass">Matte glass</option>
                <option value="Privacy glass">Privacy glass</option>
            </select>
            <button type="submit">Search</button>
        </form>
        <div class="results" id="results"></div>
    </div>
    <script>
    document.getElementById('searchForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const model = document.getElementById('model').value.trim();
        const panel = document.getElementById('panel').value;
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = 'Searching...';
        try {
            const res = await fetch('/api/mietubl', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ api_action: 'search', model, panel })
            });
            let data;
            let text = await res.text();
            try {
                data = JSON.parse(text);
            } catch (jsonErr) {
                resultsDiv.innerHTML = `<div class=\"error\">Server did not return valid JSON.<br><pre>${text.replace(/</g, '&lt;')}</pre></div>`;
                return;
            }
            if (data.success) {
                if (data.groups && data.groups.length > 0) {
                    resultsDiv.innerHTML = data.groups.map(
                        (group, i) => `<div class=\"group\"><strong>Group ${i+1}:</strong><br>${group.map(m => `<span>${m}</span>`).join(', ')}</div>`
                    ).join('');
                } else {
                    resultsDiv.innerHTML = '<div class=\"error\">No models found.</div>';
                }
            } else {
                resultsDiv.innerHTML = `<div class=\"error\">${data.error || 'Search failed.'}</div>`;
            }
        } catch (err) {
            resultsDiv.innerHTML = `<div class=\"error\">Error: ${err.message}</div>`;
        }
    });
    </script>
</body>
</html>
